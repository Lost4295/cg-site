{% extends 'base.html.twig' %}

{% block title %}Classement {% endblock %}


{% block stylesheets %}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Poppins', sans-serif; /* A more playful, modern font */
            color: var(--text-light);
        }

        .leaderboard-table thead th {
            padding: 12px 15px;
            text-transform: uppercase;
            font-size: 0.85rem;
            color: var(--text-light); /* Adapted for dark mode */
            opacity: 0.8;
            text-align: left;
            border-bottom: 2px solid var(--border); /* Adapted for dark mode */
        }

        .leaderboard-table thead .th-score {
            text-align: right;
        }

        .leaderboard-table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid var(--border); /* Adapted for dark mode */
            font-size: 0.95rem;
        }

        .leaderboard-table tbody tr {
            transition: all 0.3s ease;
        }

        .leaderboard-table tbody tr:last-child td {
            border-bottom: none;
        }

        .leaderboard-table .rank {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-light); /* Adapted for dark mode */
            width: 60px; /* Gives rank column a fixed width */
            text-align: center;
        }

        .leaderboard-table .user {
            display: flex;
            align-items: center;
        }

        .leaderboard-table .user .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            border: 2px solid var(--accent); /* Added accent border for better visibility */
        }

        .leaderboard-table .user .username {
            font-weight: 600;
        }

        .leaderboard-table .score {
            text-align: right;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--accent); /* Adapted for dark mode */
        }

        /* --- Top 3 Styling --- */
        .leaderboard-table .rank-1,
        .leaderboard-table .rank-2,
        .leaderboard-table .rank-3 {
            font-weight: 700;
        }

        /* This is a common rule for all medal pseudo-elements */
        .leaderboard-table .rank-1 .rank::before,
        .leaderboard-table .rank-2 .rank::before,
        .leaderboard-table .rank-3 .rank::before {
            font-size: 1.5rem;
            display: block;
            margin: -5px auto 5px; /* Adjust spacing of medal icon */
        }

        /* Set specific medal content for each rank */
        .leaderboard-table .rank-1 .rank::before {
            content: '\1F947'; /* 1st Place Medal */
        }

        .leaderboard-table .rank-2 .rank::before {
            content: '\1F948'; /* 2nd Place Medal */
        }

        .leaderboard-table .rank-3 .rank::before {
            content: '\1F949'; /* 3rd Place Medal */
        }

        /* Background highlights for top ranks */
        .leaderboard-table .rank-1 {
            background-color: var(--bg-medium); /* Adapted for dark mode */
            box-shadow: 0 4px 15px var(--accent-shadow); /* Added glow for 1st place */
        }

        .leaderboard-table .rank-2 {
            background-color: var(--bg-light); /* Adapted for dark mode */
        }

        .leaderboard-table .rank-3 {
            background-color: var(--bg-light); /* Adapted for dark mode */
            opacity: 0.9;
        }

        /* --- Custom Nav Pills Styling --- */
        .nav-pills .nav-link {
            background-color: var(--secondary-primary);
            color: var(--text-light) !important;
            border: 1px solid var(--border);
            margin: 0 5px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .nav-pills .nav-link:hover {
            transform: translateY(-2px);
            background-color: var(--bg-light);
            color: var(--light) !important;
        }

        .nav-pills .nav-link:focus {
            outline: none;
            box-shadow: none; /* Remove blue focus ring */
            background-color: var(--bg-light);
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-gradient-end) 100%);
            color: var(--white) !important;
            border-color: transparent;
            box-shadow: 0 4px 15px var(--accent-shadow);
        }

        .nav-pills .nav-link.active:focus {
            box-shadow: 0 4px 15px var(--accent-shadow); /* Maintain custom shadow on focus */
        }

        .nav-pills .nav-link.active::after {
            display: none !important; /* Remove the global underline style */
        }

    </style>

{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-8">
            <ul class="nav nav-pills nav-fill py-5">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-target="#pills-first" data-bs-toggle="pill"
                            id="pills-first-tab" aria-current="page" type="button" role="tab"
                            aria-controls="pills-first" aria-selected="true">Premier trimestre
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-target="#pills-second" data-bs-toggle="pill" id="pills-second-tab"
                            type="button" role="tab" aria-controls="pills-second " aria-selected="false">Deuxième
                        trimestre
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-target="#pills-third" data-bs-toggle="pill" id="pills-third-tab"
                            type="button" role="tab" aria-controls="pills-third" aria-selected="false">Troisième
                        trimestre
                    </button>
                </li>
            </ul>
            <ul class="nav d-none">
                <li>
                    <button data-bs-target="#mypoints-first" data-bs-toggle="pill"></button>
                </li>
                <li>
                    <button data-bs-target="#mypoints-second" data-bs-toggle="pill"></button>
                </li>
                <li>
                    <button data-bs-target="#mypoints-third" data-bs-toggle="pill"></button>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="pills-first" role="tabpanel"
                     aria-labelledby="pills-first-tab" tabindex="0">

                    <table class="leaderboard-table">
                        <thead>
                        <tr>
                            <th scope="col">Place</th>
                            <th scope="col">User</th>
                            <th scope="col" class="th-score">Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for index, point in points1 %}
                            {% if loop.index== 1 %}
                                <tr class="rank-1">
                                <td class="rank">1</td>
                            {% elseif loop.index== 2 %}
                                <tr class="rank-2">
                                <td class="rank">2</td>
                            {% elseif loop.index== 3 %}
                                <tr class="rank-3">
                                <td class="rank">3</td>
                            {% else %}
                                <tr>
                                <td class="rank">{{ loop.index }}</td>
                            {% endif %}
                            <td class="user">
                                <img src="https://placehold.co/45?text={{ getuserini(index) }}" alt="Avatar"
                                     class="avatar">
                                <span class="username">{{ getuser(index) }}</span>
                            </td>
                            <td class="score">{{ point }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane fade" id="pills-second" role="tabpanel" aria-labelledby="pills-second-tab"
                     tabindex="0">

                    <table class="leaderboard-table">
                        <thead>
                        <tr>
                            <th scope="col">Place</th>
                            <th scope="col">User</th>
                            <th scope="col" class="th-score">Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for index, point in points2 %}
                            {% if loop.index== 1 %}
                                <tr class="rank-1">
                                <td class="rank">1</td>
                            {% elseif loop.index== 2 %}
                                <tr class="rank-2">
                                <td class="rank">2</td>
                            {% elseif loop.index== 3 %}
                                <tr class="rank-3">
                                <td class="rank">3</td>
                            {% else %}
                                <tr>
                                <td class="rank">{{ loop.index }}</td>
                            {% endif %}
                            <td class="user">
                                <img src="https://placehold.co/45?text={{ getuserini(index) }}" alt="Avatar"
                                     class="avatar">
                                <span class="username">{{ getuser(index) }}</span>
                            </td>
                            <td class="score">{{ point }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane fade" id="pills-third" role="tabpanel" aria-labelledby="pills-third-tab"
                     tabindex="0">

                    <table class="leaderboard-table">
                        <thead>
                        <tr>
                            <th scope="col">Place</th>
                            <th scope="col">User</th>
                            <th scope="col" class="th-score">Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for index, point in points3 %}
                            {% if loop.index== 1 %}
                                <tr class="rank-1">
                                <td class="rank">1</td>
                            {% elseif loop.index== 2 %}
                                <tr class="rank-2">
                                <td class="rank">2</td>
                            {% elseif loop.index== 3 %}
                                <tr class="rank-3">
                                <td class="rank">3</td>
                            {% else %}
                                <tr>
                                <td class="rank">{{ loop.index }}</td>
                            {% endif %}
                            <td class="user">
                                <img src="https://placehold.co/45?text={{ getuserini(index) }}" alt="Avatar"
                                     class="avatar">
                                <span class="username">{{ getuser(index) }}</span>
                            </td>
                            <td class="score">{{ point }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-4" style="margin-top: 25px;">
            <div class="card">
                <div class="card-title" style="padding: 15px"> Mes points</div>
                {% if app.user %}
                <div class="d-flex justify-content-center">
                    <img src="{{ app.user.avatar }}" class="card-img-top w-25" width="75" alt="Image"/>
                </div>
            </div>
            <div class="card-body">
                {% if app.user %}
                    {% set my_points = getpts(app.user.id) %}
                {% else %}
                    {% set my_points = [0, 0, 0] %}
                {% endif %}
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="mypoints-first" role="tabpanel"
                         aria-labelledby="pills-first-tab" tabindex="0">
                        <h5 class="card-title">{{ my_points[1]??0 }} points</h5>
                    </div>
                    <div class="tab-pane fade" id="mypoints-second" role="tabpanel" aria-labelledby="pills-second-tab"
                         tabindex="0">
                        <h5 class="card-title">{{ my_points[2]??0 }} points</h5>
                    </div>
                    <div class="tab-pane fade" id="mypoints-third" role="tabpanel" aria-labelledby="pills-third-tab"
                         tabindex="0">
                        <h5 class="card-title">{{ my_points[3]??0 }} points</h5>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card-body">
                <h5 class="card-title">Veuillez vous connecter pour connaitre vos points.</h5>
            </div>
        </div>
        {% endif %}
        <p> Pour apparaître dans la liste, modifiez votre visibilité avec la commande /settings visibility on,
            ou dans vos paramètres.</p>
    </div>
    <script>
        document.querySelectorAll('[data-bs-toggle="pill"]').forEach(btn => {
            btn.addEventListener('shown.bs.tab', event => {
                const target = event.target.getAttribute('data-bs-target');

                const pointsTarget = target.replace('pills-', 'mypoints-');

                const pointsBtn = document.querySelector(`[data-bs-target="${pointsTarget}"]`);

                if (pointsBtn) {
                    const tab = new bootstrap.Tab(pointsBtn);
                    tab.show();
                }
            });
        });
    </script>

{% endblock %}
