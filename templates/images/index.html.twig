{% extends 'base.html.twig' %}

{% block title %}VÃ©rifier les images{% endblock %}

{% block additionnal_stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/check-images.css') }}">
{% endblock %}

{% block body %}
    <div class="container check-images-container">

        <!-- Page Header -->
        <div class="check-images-header">
            <h1>ğŸ–¼ï¸ VÃ©rifier les images</h1>
            <p>Validez ou refusez les images de prÃ©sence soumises par les utilisateurs</p>
            <div class="images-counter">
                ğŸ“· {{ images|length }} image(s) en attente
            </div>
        </div>

        <!-- Images Grid -->
        <div class="images-grid">
            {% for image in images %}
                <div class="image-card">
                    <div class="image-card-preview">
                        <span class="image-card-id">#{{ image.id }}</span>
                        <img src="{{ image.image }}" alt="Image de {{ image.user.fullName }}"/>
                    </div>
                    <div class="image-card-body">
                        <div class="image-card-user">
                            {{ image.user.fullName }}
                        </div>
                        <div class="image-card-actions">
                            <button id="v-{{ image.id }}" class="btn-validate">Valider</button>
                            <button id="r-{{ image.id }}" class="btn-reject">Refuser</button>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ‰</div>
                    <p class="empty-state-text">Aucune image en attente !</p>
                    <p class="empty-state-subtext">Toutes les images ont Ã©tÃ© vÃ©rifiÃ©es</p>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block additionnal_javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(function (button) {
                button.addEventListener('click', function () {
                    const [action, id] = button.id.split('-');
                    let url = '';
                    if (action === 'v') {
                        url = '/image/validate/' + id;
                    } else if (action === 'r') {
                        url = '/image/reject/' + id;
                    }
                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'Content-Type': 'application/json'
                        }
                    })
                        .then(response => {
                            if (response.ok) {
                                location.reload();
                            } else {
                                alert('Une erreur est survenue.');
                            }
                        })
                        .catch(error => {
                            console.error('Erreur:', error);
                            alert('Une erreur est survenue.');
                        });
                });
            });
        });
    </script>
{% endblock %}
